---
title: Writing a Chez Scheme library
author: Travis Hinkelman
date: '2019-09-11'
slug: writing-chez-scheme-library
categories: ["chez-stats", "Chez Scheme"]
tags:
  - libraries
  - packages
  - statistics
  - random-variates
  - distributions
  - assertions
  - unit-tests
---



<p>Recently, I <a href="/post/exploring-scheme-implementations/">switched</a> from learning Racket to Chez Scheme. I wanted to try to repeat some of my previous Racket exercises in Chez Scheme, but quickly ran into a barrier when my <a href="/post/stochastic-population-model-r-racket/">first choice</a> required drawing random variates from a normal distribution. I looked for existing Chez Scheme libraries but came up empty. I considered <a href="https://srfi.schemers.org/srfi-27/srfi-27.html">SRFI 27: Sources of Random Bits</a>, which includes example code for generating random numbers from a normal distribution, and <a href="https://www.reddit.com/r/scheme/comments/cnw0cy/generating_random_variates/">reached out for guidance</a>. Ultimately, I decided that it would be a good exercise to write a library for generating random variates from different distributions. As I started to write the random variate procedures, I realized that I minimally needed procedures for calculating mean and variance to test the output of the random variate procedures. And, thus, the scope of the library started to expand and the <a href="https://github.com/hinkelman/chez-stats"><code>chez-stats</code> library</a> was born.</p>
<p>Writing <code>chez-stats</code> has been a great learning experience. Even though I have lots of applied statistics experience, I had no idea that <a href="https://www.johndcook.com/blog/standard_deviation/">accurately calculating sample variance is challenging</a> or that there are nine algorithms to choose from when using <a href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/quantile.html"><code>quantile</code> in R</a><a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> (and now also in <code>chez-stats</code>).</p>
<p>When I was <a href="/post/programming-horizons/">choosing a new programming language to learn</a>, I did not make the size of the package ecosystem a key consideration, but, in retrospect, I think it was clearly a factor in choosing Racket. And, as I started to switch my attention to Chez Scheme, I had several moments where I almost went running back to Racket when faced with the lack of third-party libraries for Chez Scheme. I’m not keen on reinventing the wheel, but I previously underestimated how valuable that experience could be.<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> As I gain experience with Chez Scheme, it will be interesting to see if I continue to value writing my own libraries<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a> or start to lament the lack of libraries.</p>
<p>When I started working on <code>chez-stats</code>, I made a couple of decisions to simplify my efforts. For one, I made it specific to Chez Scheme rather than try to write portable scheme code. Second, I stuck to the list as the primary data structure. It would be nice to have the flexibility to also work with vectors, but I am kicking that can down the road.</p>
<p>I’m still not sure if I chose a sensible structure for the files and procedures. I separated <code>statistics</code> and <code>random-variates</code> into two separate libraries<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a> that need to be imported separately.</p>
<pre><code>(import (chez-stats statistics)
        (chez-stats random-variates))</code></pre>
<p>I also wrote a bunch of assertion procedures for checking inputs and put them in another library, <code>(chez-stats assertions)</code>. It feels weird to expose the assertion procedures as a library, and, honestly, I can’t remember why I chose to do that over just loading them from a file. If I continue to write libraries for Chez Scheme, though, it will probably make sense to pull <code>assertions</code> out of <code>chez-stats</code> into a standalone library.</p>
<p>When writing the procedures in <code>chez-stats</code>, I primarily consulted <a href="https://www.r-project.org">R</a> source code for <code>statistics</code> and <a href="https://www.cse.wustl.edu/~jain/books/ftp/ch5f_slides.pdf">slides by Raj Jain</a> for <code>random-variates</code>. I used <a href="https://srfi.schemers.org/srfi-64/srfi-64.html">SRFI 64: A Scheme API for Test Suites</a> to write a test suite for <code>chez-stats</code>. In over ten years of writing R code, I have never written any tests. It’s definitely more tedious and less fun than writing the core <code>chez-stats</code> procedures, but I find it very satisfying to see the test suite run without any failures. I used markdown to write some basic documentation in the README hosted on the GitHub repo. By far, writing documentation is my least favorite part of this whole process.</p>
<p>As of right now, I have no plans to expand the functionality of <code>chez-stats</code>. My next steps will be to try to put <code>chez-stats</code> to work for me and, in the process, identify friction points and missing features.</p>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>I had only ever used the default value.<a href="#fnref1" class="footnote-back">↩</a></p></li>
<li id="fn2"><p>And <strong>vastly</strong> underestimated how satisfying that experience could be.<a href="#fnref2" class="footnote-back">↩</a></p></li>
<li id="fn3"><p><a href="http://www.winestockwebdesign.com/Essays/Lisp_Curse.html">The Lisp Curse</a><a href="#fnref3" class="footnote-back">↩</a></p></li>
<li id="fn4"><p>Does that make <code>chez-stats</code> a collection? Or are <code>statistics</code> and <code>random-variates</code> modules? I’m still soaking up the jargon surrounding packaging scheme code.<a href="#fnref4" class="footnote-back">↩</a></p></li>
</ol>
</div>
